## coverage.py
coverage.py — инструмент для измерения покрытия кода тестами 
(какие строки/ветки/функции были выполнены при тестировании).

###  Основные команды:
```shell
    # Запуск тестов с замером покрытия
    coverage run -m pytest tests/
    
    # Отчёт в консоли
    coverage report -m  # Показывает непокрытые строки
    
    # Визуальный HTML-отчёт
    coverage html  # Генерирует htmlcov/index.html
```
### Ключевые метрики:
- Строковое покрытие (% выполненных строк)
- Ветвельное покрытие (проверка всех условий if-else)
- Покрытие функций
### Интеграция с pytest:
```shell
    pytest --cov=my_project tests/  # Замер покрытия
    pytest --cov-report=html  # + HTML-отчёт
```
Пример вывода:
```text
Name              Stmts   Miss  Cover   Missing  
---------------------------------------------  
my_module.py       50      5     90%    10-15, 20
```
### Как анализировать:
- Смотрите столбец Missing — непокрытые строки.
- В htmlcov/ открывайте файлы — красным выделены пропущенные строки.
- Оптимизируйте тесты, чтобы покрыть критические участки.

### Что важно:
- 80-90% — хороший уровень покрытия (100% редко нужен).
- Особое внимание — ветвлениям (if/else) и исключениям.
- В CI добавляйте проверку на минимальное покрытие:
```shell
    pytest --cov=my_project --cov-fail-under=80 tests/
```
### Плюсы:
- ✅ Объективно показывает слабые места в тестах
- ✅ Помогает найти неучтённые сценарии
- ✅ Интегрируется с CI/CD
###  Минусы:
- ❌ Не показывает качество тестов (только количество)
- ❌ 100% покрытие ≠ хорошие тесты
### Branch Coverage
Это метрика, которая проверяет, были ли протестированы все возможные пути выполнения в условиях (if/else, try/except).
Как использовать:
```shell
    pytest --cov=my_project --cov-branch tests/
```
Пример отчёта:
```text
Name              Stmts   Miss Branch BrPart  Cover  
--------------------------------------------------
my_module.py       50      5     10      2     85%
```
- BrPart — непокрытые ветви (например, ```else```, которую забыли протестировать).
Зачем нужно:
- В сложной логике строкового покрытия (statement coverage) недостаточно.
- Показывает «мёртвый код» (ветви, которые никогда не выполняются).
Пример:
```python
def check_age(age):
    if age >= 18:  # Ветвь 1
        return "Adult"
    else:          # Ветвь 2 (может быть не покрыта тестами!)
        return "Minor"
```
Тест check_age(20) покроет строки, но не проверит ветку else. Branch Coverage выявит эту проблему.

### Итог:
- Используйте ```coverage.py``` для измерения покрытия кода тестами
- Запускайте тесты с флагом ```--cov```
- Анализируйте отчёт, особенно непокрытые ветвления.
- Branch coverage — мощный инструмент для сложных условий.
- 100% покрытие — это идеал, но не догма.
- Стремитесь к 80% - 90% покрытия, но акцент делайте на критической логике
- В CI добавляйте проверку ```--cov-fail-under```
- Помните 100% покрытия не всегда целесобразно
###
### Примеры, где покрытие можно игнорировать:
Boilerplate-код
- Автоматически сгенерированные методы (__str__, __init__).
- Простые геттеры/сеттеры без логики:
```python
@property
def name(self):  # Нет смысла тестировать отдельно
    return self._name
```
Непрактичные сценарии
- Обработка исключений от внешних API, которые сложно смоделировать.
- Код, который выполняется только при катастрофических сбоях (например, except KeyboardInterrupt).